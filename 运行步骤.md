# 部署完整步骤

## 购买服务器

阿里云购买抢占式服务器: https://ecs-buy.aliyun.com/wizard#/spotPostpay/cn-shanghai 

## docker初始化操作

```
systemctl daemon-reload
systemctl restart docker
systemctl stop firewalld
```

## docker拉取镜像

```
docker pull consul:1.9.7
docker pull openjdk:11.0.10-jdk
docker pull zookeeper:3.5.9
docker pull wurstmeister/kafka:2.13-2.6.0
docker pull mysql:5.7.33
docker pull redis:6.0.13
```

## 部署运行环境

拷贝代码文件夹并且转到目录

修改env文件 注意ip和端口是否正确

### 运行

```
docker-compose --env-file app.env -f docker-compose-env.yml up -d
```



### 停止运行环境

```
docker-compose -f docker-compose-env.yml stop
docker-compose -f docker-compose-env.yml down
docker image rm includenomysql:1.0.0
```

### 查看日志

```
docker-compose -f docker-compose-env.yml logs mysql_miaosha
docker-compose -f docker-compose-env.yml logs kafka
```



## 运行APP Github Actions 中转DockerHub镜像版

docker-compose --env-file app.env -f docker-compose-app-withenv.yml  up -d



## 运行APP 本地打包 现场制作镜像版

分别上传jar文件至服务器目录 与dockerhub内路径名称保持一致

### 运行

```
docker-compose --env-file app.env -f docker-compose-app-build.yml up -d
```

### 停止APP环境

```
docker-compose -f docker-compose-app-build.yml stop
docker-compose -f docker-compose-app-build.yml down
docker image rm includeno/killsystem-kill:1.0
docker image rm includeno/killsystem-pay:1.0
docker image rm includeno/killsystem-api:1.0
```

### 查看日志

```
docker-compose -f docker-compose-app-withenv.yml logs consul
docker-compose -f docker-compose-app-withenv.yml logs api
docker-compose -f docker-compose-app-withenv.yml logs kill
docker-compose -f docker-compose-app-withenv.yml logs payment
```



# 测试APP接口

例子ip http://47.100.89.223

## 活动准备

http://47.100.89.223:8080/activity/prepare?itemCount=100&period=30&clearRedis=false



## 生成用户

http://47.100.89.223:8080/activity/generateUsers?count=1000



## 秒杀

http://47.100.89.223:8082/kill?killId=1&userId=1

